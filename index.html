<!DOCTYPE html>
<html>
<head>
    <title>Discover Drive</title> 
  
    <script type="text/javascript">
    var CLIENT_ID="1003542821097-ch60bub61oa3gq84p7gv3d90std7bq1j.apps.googleusercontent.com";
    var SCOPES=[
      'https://www.googleapis.com/auth/drive',
      'https://www.googleapis.com/auth/drive.file',
      'https://www.googleapis.com/auth/drive.appdata'
      ];
    /**
    * Called when the client library is loaded.
    */  
    function handleClientLoad() {
      checkAuth();
    }
    
    function checkAuth() {
      gapi.auth.authorize(
        {'client_id': CLIENT_ID, 'scope' : SCOPES.join(' '), 'immediate': false}, 
        handleAuthResult
      );
    }

    function handleAuthResult(authResult) {
      if (authResult) {
        // Access token has been successfully retrieved, requests can be sent to the API
        console.log("Access");
        listFilesInApplicationDataFolder(checkInfoFile);    
      } else {
        // No access token could be retrieved, force the authorization flow.
        gapi.auth.authorize(
          {'client_id': CLIENT_ID, 'scope': SCOPES, 'immediate': false},
          handleAuthResult);
      }
    }
    
    function loadClient(callback) {
      gapi.client.load('drive', 'v2', callback);
    }
    
    function checkInfoFile(result) {      
      insertFileInApplicationDataFolder();
      /*if(result.length == 0) {
        console.log('No Info File');
        console.log(result);
        insertFileInApplicationDataFolder();
      } else {
        console.log('No need Info File');
        console.log(result);
      }*/    
    }
    
    function printApplicationDataFolderMetadata() {
      loadClient(function () {
        var request = gapi.client.drive.files.get({
          'fileId': 'appdata'
        });
        request.execute(function(resp) {
          console.log('Id: ' + resp.id);
          console.log('Title: ' + resp.title);
        });
      });
    }
    
    function listFilesInApplicationDataFolder(callback) {
      loadClient(function () {
        var retrievePageOfFiles = function(request, result) {
          request.execute(function(resp) {
            result = result.concat(resp.items);
            var nextPageToken = resp.nextPageToken;
            if (nextPageToken) {
              request = gapi.client.drive.files.list({
                'pageToken': nextPageToken
              });
              retrievePageOfFiles(request, result);
            } else {
              callback(result);
            }
          });
        }
        
        var listRequest = gapi.client.drive.files.list({
          'q': '\'appdata\' in parents and title = \'info.json\''
        });
        retrievePageOfFiles(listRequest, []);
      });
    }

    function insertFileInApplicationDataFolder(callback) {
      const boundary = '-------314159265358979323846';
      const delimiter = "\r\n--" + boundary + "\r\n";
      const close_delim = "\r\n--" + boundary + "--";

      var reader = new FileReader();
      //reader.readAsBinaryString(fileData);
      reader.onload = function(e) {
        var contentType = fileData.type || 'application/octet-stream';
        var metadata = {
          'title': 'info.json',
          //'mimeType': contentType,
          'parents': [{'id': 'appdata'}]
        };

        //var base64Data = btoa(reader.result);
        /*var multipartRequestBody =
            delimiter +
            'Content-Type: application/json\r\n\r\n' +
            JSON.stringify(metadata) +
            delimiter +
            'Content-Type: ' + contentType + '\r\n' +
            'Content-Transfer-Encoding: base64\r\n' +
            '\r\n' +
            base64Data +
            close_delim;*/

        var request = gapi.client.request({
            'path': '/upload/drive/v2/files',
            'method': 'POST',
            'params': {'uploadType': 'multipart'}});
            /*'headers': {
              'Content-Type': 'multipart/mixed; boundary="' + boundary + '"'
            },
            'body': multipartRequestBody});*/
        if (!callback) {
          callback = function(file) {
            console.log(file)
          };
        }
        request.execute(callback);
      }
    }
    
    //check file in AppData
    // if no, make new one.
  </script>
  <script src="https://apis.google.com/js/client.js?onload=handleClientLoad"></script>    
</head>
<body>
<!--<div class="g-savetodrive" data-src="http://pagead2.googlesyndication.com/simgad/14610098017098633517" data-filename="test.jpg" data-sitename="testSite"></div>-->
<div id="divbutton1">
        <button onclick="printApplicationDataFolderMetadata()">Click</button>
</div>
</body>
</html>